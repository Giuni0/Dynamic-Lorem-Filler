\ProvidesPackage{filltext}[2025/10/22 v1.9 Dynamic Lorem filler with punctuation-safe lorem]
\RequirePackage{luacode}
\RequirePackage{xparse}

% Define Lua function safely
\begin{luacode*}
function filltext_lua(mode, target, usertext)
  
  local lorem = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla suscipit, nunc vel rhoncus blandit, est est varius purus, eu luctus ante mi sed ligula. Vestibulum vitae placerat sapien. Aliquam quis tellus sit amet tellus pretium tempus eget sodales lectus. Mauris porttitor sodales felis, in pellentesque dui tincidunt ut. Donec euismod ut nisi vel dapibus. Curabitur nec suscipit mi. Pellentesque convallis sem eu sem malesuada, eu scelerisque est porta. Donec sit amet turpis in est sagittis semper. " ..
"Vivamus et consequat tortor. Sed in lorem vitae dui feugiat euismod. Nam ut ultrices lorem. Aliquam placerat erat turpis, vitae pharetra lectus hendrerit molestie. Aenean at dapibus sem. Pellentesque convallis accumsan ex ac commodo. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Mauris ac ipsum sed augue fringilla pharetra. Suspendisse ultricies dignissim eleifend. Mauris euismod dui quis sem efficitur, luctus pharetra ipsum tristique. Donec facilisis ante ut mi malesuada dignissim. Nulla venenatis, ligula quis mattis dignissim, dolor est cursus metus, in fermentum enim libero et turpis. " ..
"Proin consequat convallis erat mattis pretium. Curabitur elementum pretium turpis et blandit. Fusce eu risus vestibulum, sodales turpis vitae, sagittis felis. Integer vitae velit vitae ante imperdiet pellentesque vitae eu diam. Fusce ullamcorper odio ac vulputate tincidunt. Aenean consequat tortor velit, sit amet egestas mi efficitur sed. Cras nisi dolor, varius sed pellentesque vitae, varius at felis. Nulla facilisi. Nunc nec pharetra justo, et hendrerit ligula. Nulla nunc odio, finibus non accumsan quis, viverra eu lacus. Nullam egestas iaculis erat, ut hendrerit urna tempor fringilla. Nulla blandit, risus eu elementum convallis, justo lectus gravida ex, eu rhoncus erat nibh eu sem. Ut metus turpis, pretium id porttitor viverra, interdum nec orci. Cras molestie mollis diam sed scelerisque. Etiam leo justo, tincidunt a nisi vitae, fermentum varius nisi. Maecenas elementum sapien ac tellus tempus venenatis. " ..
"Curabitur venenatis purus id quam egestas aliquet. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas dictum, ex vel maximus feugiat, diam velit sodales magna, in mollis eros enim sit amet ipsum. Aliquam ac leo ac eros consectetur suscipit. Nunc ut justo non felis tempus tempor vitae sit amet quam. Sed quis ullamcorper turpis, ac ornare odio. Aliquam vitae pellentesque tortor, eu consectetur augue. In hac habitasse platea dictumst. Vestibulum eleifend et enim mollis ornare. Nam euismod odio lacus. Sed sagittis dolor vel erat blandit molestie. Nunc dapibus enim quam, efficitur tempor purus scelerisque vel. " ..
"Proin eu felis tristique, finibus nisl ut, faucibus eros. Sed nec metus at mi ullamcorper elementum. Nulla eu orci eu erat bibendum malesuada egestas eu nisl. Morbi accumsan ipsum ac ex congue, in pulvinar orci lobortis. Aenean magna mi, malesuada et elementum sed, rutrum a metus. Donec ac porttitor turpis. Fusce sed efficitur arcu. Duis sollicitudin molestie risus id cursus. Nam eu accumsan lorem, tincidunt sodales lectus. Aenean ultrices, odio tempus varius convallis, risus leo bibendum urna, nec pretium justo nulla posuere dui. Sed dapibus in libero et egestas. Praesent nec odio nulla. Integer feugiat fringilla est, vel cursus lectus iaculis non. Sed vel nisl laoreet, laoreet ligula non, convallis nulla. " ..
"Donec vehicula pulvinar pharetra. Etiam luctus convallis egestas. Etiam vitae aliquet augue, in malesuada augue. Proin sed sem nec dui malesuada imperdiet. Ut venenatis sit amet mi vel sagittis. Donec quis congue urna. Integer nec risus id tellus aliquam semper. " ..
"Aenean nec finibus leo. In eu lorem urna. Nam ultrices dolor est, a ornare quam dignissim et. Donec sit amet sem a dui fermentum volutpat. Duis porta est enim, eu malesuada ipsum efficitur eu. Cras rhoncus lobortis ultricies. Ut bibendum, arcu vitae placerat eleifend, diam enim lacinia magna, non sodales purus arcu ut risus. In hac habitasse platea dictumst. Aliquam fringilla auctor lectus eu posuere. " ..
"Ut facilisis eros lacus, at fermentum nibh cursus in. Vestibulum mi justo, consequat ac risus at, bibendum dictum leo. Quisque sodales orci dui, non mattis nisi varius eu. Nam nisi purus, vestibulum quis faucibus eu, ultricies at nisi. Duis quis nisi id tortor fermentum volutpat. Nullam a lacus volutpat, interdum urna in, ornare orci. Ut sit amet cursus massa, at pellentesque ligula. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam aliquet auctor justo, a ullamcorper arcu rhoncus id. " ..
"Ut quis justo lacinia mi placerat molestie ac non ipsum. Suspendisse mollis erat nisl, tempus mattis urna sagittis eget. Donec iaculis massa efficitur purus rutrum commodo. Donec aliquam purus lectus, egestas sodales odio auctor id. Suspendisse ac porttitor metus. Cras at viverra tortor. Proin finibus dui sit amet risus aliquam, vitae rutrum felis consectetur. Praesent felis lorem, facilisis et elementum ac, luctus quis dui. Ut eleifend nisl tortor, ut efficitur quam vestibulum id. Integer sed erat eu odio tempus fermentum. Sed feugiat quam mi, vitae rutrum tortor pharetra vel. " ..
"Fusce ut ante at tortor semper vehicula. Nam quis mi eu augue lacinia volutpat eu ut quam. Donec nec faucibus risus. Duis eget tempus neque, et egestas purus. Fusce condimentum purus viverra, ornare eros tempor, viverra eros. Cras non dictum augue, vitae interdum nibh. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Sed pretium nulla non tortor tempus tincidunt. Sed eu neque dui. Proin ultrices aliquet ligula, id commodo odio vulputate et. Integer vel posuere erat, sit amet laoreet nibh. Suspendisse sit amet felis eu nibh aliquet fermentum nec sit amet neque. Nulla efficitur feugiat elit. Integer sodales lectus a purus sagittis, in porta lectus laoreet. Nullam ac felis eu purus feugiat ornare. Duis porta vitae dolor et cursus. " ..
"Ut varius id massa et ornare. Pellentesque gravida magna vitae placerat vulputate. Aenean ornare quam eu ex mollis vulputate. Donec iaculis, nunc non auctor semper, dolor odio ullamcorper ligula, vitae malesuada neque arcu et ante. Proin volutpat, turpis in sagittis tincidunt, erat neque convallis tortor, eu cursus nulla ligula non dolor. Phasellus facilisis, diam non condimentum tristique, justo nunc convallis sem, sed pretium massa risus eget nisi. Aliquam mollis neque sed viverra congue. Vestibulum ac fermentum orci. In hac habitasse platea dictumst. Sed in dignissim nibh. Sed consectetur, dolor tempus vulputate pharetra, magna libero egestas nibh, in."


  
  

  local function word_count(str)
    local c = 0
    for _ in string.gmatch(str, "%S+") do c = c + 1 end
    return c
  end

  if mode == "char" then
    local user_len = string.len(usertext)
    if user_len >= target then
      tex.sprint(usertext)
    else
      local needed = target - user_len
      local filled = usertext .. " " .. string.sub(lorem, 1, needed)
      tex.sprint(filled)
    end

  elseif mode == "word" then
    local user_words = word_count(usertext)
    if user_words >= target then
      tex.sprint(usertext)
    else
      local needed = target - user_words
      local words = {}
      for w in string.gmatch(lorem, "%S+") do
        table.insert(words, w)
        if #words >= needed then break end
      end
	  -- If lorem text does not end with punctuation, append a period
      local filled = usertext .. " " .. table.concat(words, " ")
	  if not string.match(filled, "[%.!?]$") then
	    filled = filled .. "."
	  end
      tex.sprint(filled)
    end
  else
    tex.sprint("Invalid mode: " .. mode)
  end
end
\end{luacode*}

% Wrapper LaTeX command
\NewDocumentCommand{\filltext}{O{char} m m}{%
  \directlua{
    filltext_lua("\unexpanded{#1}", tonumber("\unexpanded{#2}"), "\unexpanded{#3}")
  }%
}
